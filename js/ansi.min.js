(function(){this.ANSI=function(){function e(){this.font=this.loadFont();this.palette=[[0,0,0],[170,0,0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[170,170,170],[85,85,85],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255],[255,255,255]];this.tabstop=8;this.linewrap=80}e.prototype.toRgbaString=function(d){return"rgba("+d.join(",")+",1)"};e.prototype.loadUrl=function(d){var b;b=new XMLHttpRequest;b.open("GET",d,!1);b.overrideMimeType("text/plain; charset=x-user-defined");
b.send(null);return b.status===200||b.status===0?b.responseText:""};e.prototype.parseUrl=function(d){return this.parse(this.loadUrl(d))};e.prototype.loadFont=function(){var d,b,a,c,f;a=this.loadUrl("js/8x16.dat");d=[];for(c=0;c<=255;c++){b=[];for(f=0;f<=15;f++)b.push(a.charCodeAt(c*16+f)&255);d.push(b)}return d};e.prototype.getWidth=function(){var d,b,a;b=d=0;for(a=this.screen.length-1;0<=a?b<=a:b>=a;0<=a?b++:b--)if(this.screen[b]!=null&&this.screen[b].length>d)d=this.screen[b].length;return d};e.prototype.getHeight=
function(){return this.screen.length};e.prototype.renderCanvas=function(d){var b,a,c,f,h,i,e,g,o,l,m,n,j,k;n=this.getWidth()*8;e=this.getHeight()*16;a=document.createElement("canvas");a.setAttribute("width",n);a.setAttribute("height",e);c=a.getContext("2d");h=0;for(j=this.screen.length-1;0<=j?h<=j:h>=j;0<=j?h++:h--)if(this.screen[h]!=null){f=0;for(k=this.screen[h].length-1;0<=k?f<=k:f>=k;0<=k?f++:f--)if(g=this.screen[h][f],g!=null){i=g.attr&15;b=(g.attr&240)>>4;l=f*8;m=h*16;c.fillStyle=this.toRgbaString(this.palette[b]);
c.fillRect(l,m,8,16);c.fillStyle=this.toRgbaString(this.palette[i]);b=this.font[g.ch.charCodeAt(0)&255];for(i=0;i<=15;i++){o=b[i];for(g=0;g<=7;g++)o&1<<7-g&&c.fillRect(l+g,m+i,1,1)}}}d.setAttribute("width",n);d.setAttribute("height",e);c=d.getContext("2d");return c.drawImage(a,0,0)};e.prototype.parse=function(d){var b,a,c,f,e;this.screen=[];this.save_y=this.save_x=this.y=this.x=this.state=0;this.attr=7;this.argbuf="";for(d=d.split("");b=d.shift();)if(this.state===0)switch(b){case "\u001a":this.state=
3;break;case "\u001b":this.state=1;break;case "\n":this.x=0;this.y++;break;case "\r":break;case "\t":for(c=(this.x+1)%this.tabstop;c-- >0;)this.putpixel(" ");break;default:this.putpixel(b)}else if(this.state===1)b!=="["?(this.putpixel("\u001b"),this.putpixel("["),this.state=0):this.state=2;else if(this.state===2)if(b.match("[A-Za-z]")){a=function(){var a,b,d,e;d=this.argbuf.split(";");e=[];a=0;for(b=d.length;a<b;a++)c=d[a],e.push(parseInt(c));return e}.call(this);switch(b){case "m":f=0;for(e=a.length;f<
e;f++)b=a[f],b===0?this.attr=7:b===1?this.attr|=8:b===5?this.attr|=128:30<=b&&b<=37?(this.attr&=248,this.attr|=b-30):40<=b&&b<=47&&(this.attr&=143,this.attr|=b-40<<4);break;case "H":case "f":this.y=(a[0]||1)-1;this.x=(a[1]||1)-1;if(this.y<0)this.y=0;if(this.x<0)this.x=0;break;case "A":this.y-=a[0]||1;if(this.y<0)this.y=0;break;case "B":this.y+=a[0]||1;break;case "C":this.x+=a[0]||1;break;case "D":this.x-=a[0]||1;if(this.x<0)this.x=0;break;case "E":this.y+=a[0]||1;this.x=0;break;case "F":this.y-=a[0]||
1;if(this.y>0)this.y=0;this.x=0;break;case "G":this.x=(a[0]||1)-1;break;case "s":this.save_x=this.x;this.save_y=this.y;break;case "u":this.x=this.save_x;this.y=this.save_y;break;case "J":if(a.length===0||a[0]===0){c=a=this.y+1;for(b=screen.length-1;a<=b?c<=b:c>=b;a<=b?c++:c--)this.screen[c]=null;c=a=this.x;for(b=screen[this.y].length-1;a<=b?c<=b:c>=b;a<=b?c++:c--)this.screen[this.y][c]=null}else if(a[0]===1){c=0;for(a=this.y-1;0<=a?c<=a:c>=a;0<=a?c++:c--)this.screen[c]=null;c=0;for(a=this.x;0<=a?
c<=a:c>=a;0<=a?c++:c--)this.screen[this.y][c]=null}else if(a[0]===2)this.y=this.x=0,this.screen=[];break;case "K":if(a.length===0||a[0]===0){c=a=this.x;for(b=this.screen[this.y].length-1;a<=b?c<=b:c>=b;a<=b?c++:c--)this.screen[this.y][c]=null}else if(a[0]===1){c=0;for(a=this.x;0<=a?c<=a:c>=a;0<=a?c++:c--)this.screen[this.y][c]=null}else a[0]===2&&(this.screen[this.y]=null)}this.argbuf="";this.state=0}else this.argbuf+=b;else if(this.state===3)break;else this.state=0;return[]};e.prototype.putpixel=
function(d){this.screen[this.y]==null&&(this.screen[this.y]=[]);this.screen[this.y][this.x]={ch:d,attr:this.attr};if(++this.x>=this.linewrap)return this.x=0,this.y++};return e}()}).call(this);